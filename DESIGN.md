# 設計書：デュエル・オブ・フュージョン

## 1. プロジェクト概要

* **目的**: 本作『デュエル・オブ・フュージョン』は、戦略的なカードバトルを楽しめるデジタルカードゲームです。
本プロジェクトは、プレイヤーに以下のユニークなゲーム体験を提供することを主な目的としています。

斬新な戦略性の提供:
独自の「フュージョンデッキシステム（両プレイヤーのデッキを予め混ぜ合わせて共有山札とするルール）」により、従来のカードゲームにはない予測不能な展開を生み出します。プレイヤーは相手のカードをも自らの戦略に組み込む柔軟な思考力と、状況に応じた即興的な判断力を駆使して勝利を目指します。これにより、毎回の対戦が新鮮でリプレイ性の高い体験となることを目的とします。

直接的でダイナミックな攻防の実現:
「デッキマスターシステム（プレイヤーのライフポイントを兼ねる5体のユニット）」を導入することで、抽象的なライフポイントの削り合いではなく、盤上の具体的なユニットへの攻撃と防御をゲームの中心に据えます。これにより、どのデッキマスターを優先して攻撃/防御するかといった戦術的な深みと、ダイレクトな戦闘の駆け引きの面白さを提供します。

多様な戦術の探求とデッキ構築の楽しみ:
現在実装されている「スチームパンク・オートマタ」「天空の詠唱者」「深淵の招魂師団」といった特徴の異なる複数のカードテーマを通じて、プレイヤーが自分だけのオリジナルデッキを構築し、多様な戦術やコンボを探求する楽しみを提供します。

また、本プロジェクトは制作者のポートフォリオの一部として、以下の技術的・設計的目標の達成も目的としています。

Web技術によるゲーム開発能力の実証:
HTML、CSS、JavaScript（ES6+）という基本的なWeb技術のみを使用し、外部ライブラリに極力頼らずに、インタラクティブで複雑なルールを持つゲームアプリケーションをゼロから設計・実装する技術力を示すこと。

ゲームデザインとバランス調整能力の習得と実践:
オリジナルのカード効果、ゲームルール、テーマデッキを考案し、それらのバランスを実際にプレイテストしながら調整していくプロセスを通じて、ゲームデザインの基礎と面白さを追求する能力を実践的に学ぶこと。

ソフトウェアエンジニアリングの基礎実践:
ユニットテストの導入（Jest使用）、設計ドキュメントの作成、コードのリファクタリングといった活動を通じて、コードの品質、可読性、保守性を意識した開発プロセスを体験し、堅牢なソフトウェアを構築するための基本的なエンジニアリングプラクティスを身につけること。


* **開発動機**: 特にこだわったのは、既存のカードゲームの枠組みに囚われない、デジタルならではの新しい遊びの提供です。

第一に、紙のカードゲームでは物理的な制約から実現が難しい「両プレイヤーのデッキを融合させ、一つの巨大な山札として共有する」という大胆なルールを採用しました。これにより、毎回のドローが予測不能なものとなり、相手のカードすら自らの戦略に組み込む柔軟な思考とアダプティブな対応力が求められる、スリリングで奥深い対戦体験が生まれると考えました。これは、ゲームタイトルにも込めた「フュージョン（融合）」というコンセプトの核となっています。

第二に、従来のライフポイントシステムに代わる、より直接的で戦略的な攻防を生み出す要素として、「自身のライフポイントとしての役割も担う5体のデッキマスター」という独自の概念を導入しました。これらのデッキマスターは、単なる体力ゲージではなく、それぞれが守るべき城であり、破壊すべき具体的なターゲットとなります。どのデッキマスターから攻めるか、あるいは自軍のどのデッキマスターをどう守るかといった、盤面に応じた駆け引きの深まりと、勝利条件の明確化を目指しました。

これらの独自のメカニクスを通じて、プレイヤーにこれまでにない新鮮な戦略的思考の楽しさと、対戦の度に異なる展開が待ち受ける興奮を提供したいという思いが、この「デュエル・オブ・フュージョン」開発の大きな動機となりました。

## 2. 技術スタック

* **使用言語**: HTML5, CSS3, JavaScript (ES6+)
* **テストフレームワーク**: Jest
* **開発環境**: VS Code, Node.js (Jest実行のため), Live Server (VS Code拡張機能)など


## 3. アーキテクチャ

### 3.1. ファイル構成

* `index.html`: ゲームの骨格となるUI構造（各画面、ゾーン、ボタンなど）を定義。
* `style.css`: ゲーム全体のデザイン、レイアウト、カードの見た目、視覚効果を定義。
* `script.js`: ゲームのメインロジック。UI要素の取得、イベントリスナーの設定、ゲーム進行管理、DOM操作による画面更新など、現在ほぼ全てのクライアントサイド処理を担う。
* `gameLogic.js`: `script.js`から分離された、UIに依存しない純粋なゲームロジック関数（`shuffleArray`, `drawOneCard`, `resolveCombatRound`など）を格納。ユニットテストの対象。
* `*.test.js` (例: `shuffleArray.test.js`): 各ロジック関数に対応するJestのユニットテストコード。

### 3.2. 状態管理 (State Management)

* ゲームの全ての状態は、`script.js`内で定義されているグローバルな`gameState`オブジェクトによって一元管理される。
* **`gameState`の主要なプロパティ説明**:
    * `turn`, `currentPhase`, `currentPlayer`: ゲームの進行状況。
    * `self`, `opponent`: 各プレイヤーの状態オブジェクト。
        * `currentMana`, `maxMana`: マナ情報。
        * `deckMasters`: デッキマスターの状態（場にいるか、HPなど）。
        * `hand`: 手札のカード情報。
        * `field`: フィールドのクリーチャー情報（`{card, currentHP, powerCounters, hasActedThisTurn, isAwakened}`など）。
        * `destroyedDeckMastersCount`: 破壊されたデッキマスターの数。
        * `spellsCastThisTurn`: `[連鎖]`判定用。
        * `solarisAbilityUsedThisTurn`, `licheAbilityUsedThisTurn`: 特定DMの能力使用フラグ。
        * `nextSpellCostReduction`: 《魔力循環》用。
    * `mainDeck`: 共通の山札。
    * `graveyard`: 共通の墓地。
    * `awaitingSpellTarget`, `pendingSolarisEffect`: スペルや能力のターゲット選択中の一時情報。
* `gameState`は「唯一の信頼できる情報源 (Single Source of Truth)」とし、全ての描画処理(`renderHand`, `renderField`など)はこのオブジェクトの状態に基づいて行われる。

### 3.3. 主要なロジックフロー

* **ゲーム開始 (`initializeGame`)**: デッキシャッフル、初期手札配布、デッキマスター配置、初期マナ設定など。
* **ターン進行**: ドローフェーズ → メインフェーズ → （攻撃フェーズ） → エンドフェーズ。
* **カードプレイ (`handleCardClick`)**: マナ消費、手札から場へ移動、効果解決（`resolveOnSummonEffect`, `resolveSpellEffect`）。
* **戦闘処理 (`performCombat` -> `gameLogic.js`の`resolveCombatRound`を利用予定)**: ATK計算（バフ、能力考慮）、HP計算、破壊処理（`destroyCard`）。
* **AIのターン (`startOpponentTurn`)**: ドロー、マナ、クリーチャー召喚、攻撃といった一連の思考ロジック。

## 4. テスト方針

* **目的**: ゲームのコアロジックの品質保証、機能追加・修正時のバグ混入（デグレード）防止。
* **手法**: Jestを用いたユニットテスト。
* **対象**: `gameLogic.js`に分離された、UIに依存しない純粋な関数を主とする。
    * 現在テスト済みの関数: `shuffleArray`, `drawOneCard`, `resolveCombatRound` (基本パターン)。
* **今後の拡充**:
    * `resolveCombatRound`のテストケース追加（ワイト、コア・マキナ覚醒、カウンターを組み合わせた複雑なケースなど）。
    * スペル効果解決ロジックのテスト（例：火球、手札補充など）。
    * 召喚時効果解決ロジックのテスト（例：コア・マキナ覚醒条件判定、リッチェのミル＆チューターなど）。

## 5. 今後の課題・拡張予定

* **UI/UX改善**:
    * 墓地確認機能の実装。
    * サウンドエフェクト、BGMの追加。
    * カードプレイや戦闘時のアニメーション追加。
* **未実装のカード能力**:
    * エレメンタリスト：《魔力循環》のコスト軽減の完全実装、《ソラリス》の常時能力（ダメージ効果のターゲット選択と実行）。
    * ネクロマンサー：《リッチェ》の起動能力、《血の儀式の司祭》の起動能力。
* **AIの強化**: より戦略的な思考ルーチンの実装。
* **カード追加とバランス調整**。
* **ネットワーク対戦機能の検討**。
